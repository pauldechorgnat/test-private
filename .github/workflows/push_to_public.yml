name: Push public files to another repo

on:
  push:
    branches:
      - develop
  
jobs:
  push:
    name: Push public files to public repo
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: re-initialize repo
        shell: bash
        id: git-status
        env:
          GIT_USERNAME: ${{secrets.GIT_USERNAME}}
          GIT_USER_EMAIL: ${{secrets.GIT_USER_EMAIL}}
          GIT_REMOTE_REPO: ${{secrets.GIT_REMOTE_REPO}}
        run: |
          echo $GIT_REMOTE_REPO $GIT_USER_EMAIL 
          git config --global user.email $GIT_USER_EMAIL
          git config --global user.name $GIT_USERNAME
          export git_message=$(git log -1 --pretty=%B)
          echo $git_message
          rm -r .git
          git init
          echo -e "\n" >> .gitignore
          cat .gitignore.public >> .gitignore
          git status
          cat .gitignore
          git add --all
          git status
          git commit -m "$git_message"
          git status
          git remote add origin $GIT_REMOTE_REPO
          git push --set-upstream origin master
